---

- name: Test NXOS access
  hosts: nexus
  gather_facts: no

  tasks:
   - name: Configure Hostname
     cisco.nxos.nxos_hostname:
       config:
         hostname: "{{ hostname }}"
       state: merged
   
   - name: Configure NTP Server
     cisco.nxos.nxos_ntp_global:
       config:
         servers:
           - server: "{{ ntp_server }}"
             use_vrf: management
             prefer: True
       state: merged
   
   - name: Enable Features
     cisco.nxos.nxos_feature:
       feature: "{{ item }}"
       state: enabled
     loop: "{{ features }}"

   - name: Enable Features
     cisco.nxos.nxos_feature:
       feature: "{{ item }}"
       state: enabled
     loop: "{{ enabled_features }}"
